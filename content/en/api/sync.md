---
title: "Synchronous Design Principles"
weight: 10
type: docs
---

Well-designed REST API attract developers to build apps that use them. An API interface should be easy to understand and intuitive for developers.

{{< blocks/section color="white" >}}
{{% blocks/feature icon="fa-wheelchair" title="Level 0 — Legacy" %}}
Single URI and HTTP method<br />
(typically POST)<br />
Using XML to communicate
{{% /blocks/feature %}}

{{% blocks/feature icon="fab fa-accessible-icon" title="Level 1 — Resources" %}}
API should have a unique URL for each resource.
{{% /blocks/feature %}}

{{% blocks/feature icon="fa-motorcycle" title="Level 2 — Verbs" %}}
This level also requires us to use correct HTTP methods, status codes, paging, filtering, sorting, searching and versioning.
{{% /blocks/feature %}}
{{< /blocks/section >}}

Our strategy is to **achieve Level 2 on all our <abbr data-toggle="tooltip" title="Agnostic for business processes & consumption and minimalistic APIs created for multiple consumers.">canonical</abbr> APIs**. 

## URI Path Design
```
https:// api.leroymerlin.ru / domain / application / v1 / products?siteId=1234&statusCode=active
\_____/\___________________/\_______/\____________/\___/\_________/\___________________________/
 scheme        host         LM domain  system     major  resource        query parameters
                              group     name     version
```

#### Use `kebab-case` for URLs and `camelCase` for parameters and attributes.

* Each resource has its own endpoint. 
* Resource name is always in plural.
* If a resource is related to another resource, use sub-resources.
{{% alert color="success" %}}
`/customers/{id}/addresses` all addresses of customer {id}
{{% /alert %}}
* Limit to 1 level of depth.
{{% alert color="danger" %}}
`/suppliers/{id}/products/{id}/media/{id}` too much inheritance
{{% /alert %}}
* You can use singular form when only one resource of a type exists (natural singleton).
{{% alert color="success" %}}
`/delivery/v1/products` there are no more deliveries
{{% /alert %}}

{{% alert color="success" title="Good examples" %}}
`/customers` all customers <br />
`/customers/{id}/addresses` all addresses of customer {id} <br />
`/products?supplierId={supplierId}` get a list of products from a supplier <br />
`/products/{id}` get the detail of a product <br />
`/products/{id}/media` list all media for a product
{{% /alert %}}

#### Moderate granularity.
Do not return unnecessary information.

{{% alert color="danger" title="/clients/1/address" %}}
<pre>{
  “road”: “121 rue Chanzy”,
  “city”: “Hellemmes”,
  “country”: “France”,
  <b><s>“age”: 22</s></b>
}
</pre>
{{% /alert %}}

#### Use surrogate keys correctly.
The Surrogate key is internally generated by the system but is nevertheless visible to the user or application as opposed to Natural key that is formed of attributes that already exist in the real world.

REST APIs should try to be discoverable. Don’t use rowID as an API resource identifier because, in case of replacing the database, it could violate the integrity of the integrations based on the API. Also, it is not recommended to use real database keys for security reasons.

{{% alert color="success" title="Good examples" %}}
`/some-resource?tag=green` natural key “green” has meaning to users<br />
`/customer/0012345` customer ID is an API generated value
{{% /alert %}}

{{% alert color="danger" title="Bad examples" %}}
`/some-resource?tag=1` returns all resources tagged with «green» via tag number «1»<br />
`/customer/23dde7-e89b-12d3-a456-4265` customer ID is UUID value used as DB primary key
{{% /alert %}}

## HTTP Verbs
* `GET` obtaining data
* `POST` creation data
* `PUT` overwriting by the new data sent
* `PATCH` partial update of the data
* `DELETE` delete data
* `OPTIONS` returns the HTTP methods that the server supports for the specified URL

### When it is not appropriate
* use the method POST
* use action verbs
* use the pattern `/collections/{resource}:{action}`
{{% alert color="success" title="Example" %}}
`POST /users/123:subscribe`
{{% /alert %}}

## URL Query Parameters

#### Header parameters
Contains technical parameters or elements of «context».
```
Content-Type: application/json
ADEO-BU-CODE: 10
```

#### Path parameters
These are parameters that are part of the URL. They are used to identify a resource. 
{{% alert color="success" %}}
`/product/{id}/stocks` 
{{% /alert %}}

#### Query parameters
They allow the response to be filtered according to certain criteria.

{{% alert color="success" title="Good examples" %}}
`/products?q=Luke+man` searches for products with the text specified <br />
`/products?storeId=35` filters all products where storeId is 35 <br />
`/products?sort=name&desc=age,id` sorts by name in ascending order and descending: age then id.
{{% /alert %}}

## Pagination
* Paginate by page number.
{{% alert color="success"%}}
`?page=2&perPage=100` 
{{% /alert %}}
* Paginate by cursor.
{{% alert color="success"%}}
`?limit=25&before=ZDMyNz6yORI3OTLo`
{{% /alert %}}
*Don't store cursors. Cursors can quickly become invalid if items are added or deleted.*
* Paginate through offset & limit.
{{% alert color="success"%}}
`?limit=25&offset=50`
{{% /alert %}}
* Paginate with timelines.
{{% alert color="success"%}}
`?limit=25&since=1364849754`
{{% /alert %}}
*Time pagination is used to navigate through results data using Unix timestamps which point to specific times in a list of data.*

## Response: Conventions

* HTTP response data structure should be decoupled from the database data structure
* all fields should make sense to a business person
* all names used should be simple, intuitive and consistent
* avoid technical values or values from an information system

## Response: Status Codes
#### All methods
* Standard Codes must be used for all rest API.
* Every service must potentially return a 500 error.
* Every service with, at least, one required parameter must return a 4xx class of response with the explanation of error.
* Every secured service MUST return a 401 status code

#### GET
* Every one resource service must return a 404 status code (in case of data not found).
* Every collection service must return a 200 status code if return all the collection in one call.
* Every collection service should return a 206 status code if return only a part of the the collection in one call. 

#### POST
* Every secured service must return a 401 status code.

#### PUT & PATCH:
* Every service used to create a resource must return a 201 status code. 

#### DELETE
* Every service must return a 204 status code.

## HTTP response: Error Codes
Along with the HTTP response status code, the sample error response payload should also be specified. This helps the consumer application parse error messages. The error response payload may include specific business error codes and descriptive error messages that offer information about the exact cause of the error. All error codes and error messages should be defined in the API documentation.

One of the popular standards that cover error reporting is JSON-API: 
```
{
  "errors": [{
    "code": "ERR-01234",
    "title": "OAuth Exception",
    "details": "Session has expired at unix time 1385243766.", 
    "links": {
      "about": "http://example.com/docs/errors/#ERR-01234"
    }
  }]
}
```

A snippet of a Swagger format specification in an API document, with the response code and error codes defined:
```
{ 
  Responses:
    ”200”:
      description: mySuccessResponse
  Schema:
    type: array
  Items:
    $ref: “#/definitions/Pet”,
    “400”: 
      description: Invalid status value
}
```

## Responses: data conventions
#### E.164 – phone number format
***[+][country code][area code][local phone number]***

* `+` plus sign
* `country code` international country code
* `area code/national destination code` code without leading 0
* `phone number` local phone number

#### ISO 639 – language

* `eng` – English 
* `fra` – French
* `rus` – Russian

#### ISO 3166-1 — language

* `Russia (Russian Federation) Россия` `RU` `RUS` `643`
* `France` `Франция` `FR` `FRA` `250`
* `China` `Китай` `CN` `CHN` `156`

#### ISO 8601 – Date

* `YYYY-MM` 2020-06
* `YYYYMMDD` 20200602
* `YYYY-MM-DDThh:mm:ss±hh` 2020-06-02T15:22:00+00:00

#### ISO 4217 — Money

* `EUR` `978` – Euro
* `USD` `840` - US Dollar
* `KZT` `398` – Tenge
* `BYN` `933` - Belarussian Ruble

#### UCUM – measurements

For all measurements check [UCUM specification](https://unitsofmeasure.org/).